<div th:fragment="content">
    <section class="content-header">
        <div class="container-fluid">
            <div class="row py-2">
                <div class="col-sm-6 px-5 pt-3">
                    <h4><i class="fa-solid fa-list-check text-green-600"></i> MiCompraYA / Auditoría de Inventario</h4>
                </div>
                <div class="col-sm-6 px-5 pt-4">
                    <div class="text-end">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalReporteFechas">
                            <i class="fa-solid fa-file-pdf"></i> Reporte por Fechas
                        </button>

                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalMovimiento">
                            <i class="fa-solid fa-plus-circle"></i> Registrar Movimiento
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="content">
        <div class="container-fluid px-5">
            <div class="card shadow-sm">
                <div class="card-body table-responsive">
                    <table id="tbl" class="table table-striped table-hover">
                        <thead class="table-light">
                        <tr>
                            <th>Fecha</th>
                            <th>Producto</th>
                            <th>Tipo Mov.</th>
                            <th>Usuario</th>
                            <th class="text-end">Cant.</th>
                            <th class="text-end">Stock Ant.</th>
                            <th class="text-end">Stock Nuevo</th>
                            <th>Descripción</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="t : ${transacciones}">
                            <td th:text="${#temporals.format(t.fechaTransaccion, 'dd/MM/yyyy HH:mm')}"></td>
                            <td class="fw-bold text-primary" th:text="${t.producto.nombre}"></td>

                            <td>
                                    <span class="badge"
                                          th:classappend="${t.tipoMovimiento.operacion == 'SUMA' ? 'bg-success' : 'bg-danger'}"
                                          th:text="${t.tipoMovimiento.nombre}">
                                    </span>
                            </td>

                            <td th:text="${t.usuario.nombreUsuario}"></td>
                            <td class="text-end fw-bold" th:text="${t.cantidad}"></td>
                            <td class="text-end text-muted" th:text="${t.stockAnterior}"></td>
                            <td class="text-end fw-bold" th:text="${t.stockNuevo}"></td>
                            <td class="small text-muted" th:text="${t.descripcion}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <div class="modal fade" id="modalMovimiento" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered"> <div class="modal-content border-0 rounded-2xl shadow-2xl overflow-hidden">

            <div class="modal-header bg-gradient-to-r from-green-600 to-green-500 text-white border-0 p-4">
                <h5 class="modal-title flex items-center gap-2 font-bold text-lg">
                    <i class="ri-exchange-box-line text-xl"></i>
                    Registrar Movimiento de Inventario
                </h5>
                <button type="button" class="btn-close btn-close-white opacity-80 hover:opacity-100 transition-opacity" data-bs-dismiss="modal"></button>
            </div>

            <form th:action="@{/transacciones/guardar}" method="post">
                <div class="modal-body p-5 bg-gray-50">

                    <div class="row g-4">

                        <div class="col-12">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">
                                <i class="ri-shopping-basket-2-line text-green-600 mr-1"></i> Producto
                            </label>
                            <select name="productoId" class="form-select form-select-lg border-gray-300 rounded-lg shadow-sm focus:border-green-500 focus:ring focus:ring-green-200 transition-all text-base py-2.5" required>
                                <option value="" selected disabled>Seleccione un producto del inventario...</option>

                                <th:block th:each="cat : ${categorias}">
                                    <optgroup th:label="${cat.categoria}">
                                        <option th:each="p : ${productos}"
                                                th:if="${p.categoria.id == cat.id}"
                                                th:value="${p.id}"
                                                th:text="${p.nombre} + ' (Stock Actual: ' + ${p.stock} + ')'">
                                        </option>
                                    </optgroup>
                                </th:block>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">
                                <i class="ri-arrow-left-right-line text-blue-600 mr-1"></i> Tipo de Acción
                            </label>
                            <select name="tipoMovimientoId" class="form-select border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 transition-all" required>
                                <option value="" selected disabled>-- Seleccione Tipo --</option>
                                <option th:each="tm : ${tiposMovimiento}"
                                        th:value="${tm.id}"
                                        th:text="${tm.nombre}">
                                </option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">
                                <i class="ri-numbers-line text-orange-500 mr-1"></i> Cantidad
                            </label>
                            <div class="input-group shadow-sm">
                                <input type="number" name="cantidad" class="form-control border-gray-300 rounded-l-lg focus:border-green-500 focus:ring-green-200"
                                       min="1" placeholder="Ej: 10" required>
                                <span class="input-group-text bg-white text-gray-500 border-gray-300 rounded-r-lg">unid.</span>
                            </div>
                        </div>

                        <div class="col-12">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">
                                <i class="ri-file-text-line text-gray-500 mr-1"></i> Justificación / Detalle
                            </label>
                            <textarea name="descripcion" class="form-control border-gray-300 rounded-lg shadow-sm focus:border-green-500 focus:ring-green-200 transition-all resize-none"
                                      rows="3" placeholder="Escriba aquí el motivo del ajuste (ej: Uso para limpieza, merma por daño, etc.)" required></textarea>
                        </div>

                    </div>
                </div>

                <div class="modal-footer border-t border-gray-200 bg-gray-100 px-5 py-3">
                    <button type="button" class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition font-medium" data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 shadow-md hover:shadow-lg transition-all flex items-center gap-2 font-medium">
                        <i class="fa-solid fa-save"></i> Guardar Registro
                    </button>
                </div>
            </form>
        </div>
        </div>
    </div>

    <div class="modal fade" id="modalReporteFechas" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 rounded-2xl shadow-lg">
                <div class="modal-header bg-blue-600 text-white border-0">
                    <h5 class="modal-title font-bold">
                        <i class="fa-solid fa-calendar-days"></i> Generar Reporte de Movimientos
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form th:action="@{/transacciones/reporte/pdf}" method="post" target="_blank">
                    <div class="modal-body p-4">
                        <p class="text-gray-600 mb-4">Selecciona el rango de fechas para generar el reporte en PDF:</p>

                        <div class="row g-3">
                            <div class="col-6">
                                <label class="form-label fw-bold">Fecha Inicio</label>
                                <input type="date" name="fechaInicio" class="form-control" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label fw-bold">Fecha Fin</label>
                                <input type="date" name="fechaFin" class="form-control" required>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer bg-gray-50">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa-solid fa-download"></i> Descargar PDF
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>


</div>