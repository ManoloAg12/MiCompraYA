<div th:fragment="content">
    <section class="content-header">
        <div class="container-fluid">
            <div class="row py-2">
                <div class="col-sm-6 px-5 pt-3">
                    <h4><i class="fa-solid fa-user-group text-green-600"></i> Usuarios</h4>
                </div>
                <div class="col-sm-6 px-5 pt-4">
                    <ol class="breadcrumb justify-content-end d-flex">
                        <li class="breadcrumb-item">Inicio</li>
                        <li class="breadcrumb-item active text-success">usuarios</li>
                    </ol>
                </div>
            </div>
        </div>
    </section>

    <section class="content">
        <div class="container-fluid px-5">
            <div class="card-body">
                <a role="button" class="inline-flex items-center px-4 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition" data-bs-toggle="modal" data-bs-target="#agregarModal"><i class="fa-solid fa-circle-plus"></i> Agregar usuario</a>
                <a role="button"
                   th:if="${session.usuario != null and session.usuario.rol.id == 1}"
                   class="inline-flex items-center px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
                   data-bs-toggle="modal"
                   data-bs-target="#agregarClienteModal">
                    <i class="fa-solid fa-users mr-2"></i> Agregar Cliente
                </a>
                <div class="table-responsive px-2 py-4">
                    <table id="tbl" class="table table-striped table-cell-border table-hover" width="100%" cellspacing="0">
                        <thead>
                        <tr><!--Etiqueta para crear una fila-->
                            <th>N°</th>
                            <th>Usuario</th><!--Etiqueta para crear columnas de cabecera-->
                            <th>Correo</th>
                            <th>Fecha de reg.</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th></th>
                            <th></th>

                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="u, iterStat : ${usuarios}" th:attr="data-id=${u.id}" th:if="${session.usuario.rol.id == 1 or (session.usuario.rol.id == 4 and u.rol.id == 3)}">
                            <td th:text="${iterStat.index + 1}"></td>
                            <td class="col-usuario" th:text="${u.nombreUsuario}"></td>
                            <td class="col-correo" th:text="${u.correo}"></td>
                            <td class="col-fecha" th:text="${#temporals.format(u.fechaRegistro, 'dd/MM/yyyy')}"></td>
                            <td class="col-rol" th:text="${u.rol.rol}"></td>
                            <td class="col-estado" th:text="${u.estado.estado}"></td>
                            <td class="text-center">
                                <a data-bs-toggle="modal"
                                   data-bs-target="#editarModal"
                                   class="text-primary btn-editar"
                                   role="button"
                                   title="Modificar registro"
                                   th:attr="data-id=${u.id}">
                                    <i class="fa-solid fa-edit"></i>
                                </a>
                            </td>
                            <td class="text-center">
                                <a
                                        th:if="${u.id != session.usuario.id}"
                                        data-bs-toggle="modal"
                                        data-bs-target="#eliminarModal"
                                        th:attr="data-id=${u.id}"
                                        class="text-danger"
                                        role="button"
                                        title="Inactivar usuario">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </td>

                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </section>
    <!-- Modal para agregar usuario -->
    <div class="modal fade" id="agregarModal" tabindex="-1" aria-labelledby="agregarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content shadow-xl border-0 rounded-4 overflow-hidden">

                <!-- Header -->
                <div class="modal-header bg-gradient-to-r from-green-600 to-green-500 text-white shadow-sm">
                    <h5 class="modal-title flex items-center gap-2" id="agregarModalLabel">
                        <i class="fa-solid fa-user-plus"></i> Agregar usuario
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <!-- Body -->
                <div class="modal-body bg-white">
                    <form id="formAgregar" th:action="@{/usuarios/guardar}" th:object="${nuevoUsuario}" method="post" class="space-y-4">

                        <!-- Usuario -->
                        <div>
                            <label for="inputUsuario" class="form-label fw-semibold">Usuario</label>
                            <input type="text"
                                   class="form-control rounded-3 border-2 border-gray-200 focus:border-green-500 focus:ring-0 shadow-sm"
                                   id="inputUsuario"
                                   th:field="*{nombreUsuario}"
                                   placeholder="Ingrese usuario" required>
                        </div>

                        <!-- Correo -->
                        <div>
                            <label for="inputCorreo" class="form-label fw-semibold">Correo</label>
                            <input type="email"
                                   class="form-control rounded-3 border-2 border-gray-200 focus:border-green-500 focus:ring-0 shadow-sm"
                                   id="inputCorreo"
                                   th:field="*{correo}"
                                   placeholder="ejemplo@correo.com" required>
                        </div>

                        <!-- Rol -->
                        <div>
                            <label for="rol" class="form-label fw-semibold">Rol</label>
                            <select id="rol"
                                    class="form-select rounded-3 border-2 border-gray-200 focus:border-green-500 focus:ring-0 shadow-sm"
                                    th:field="*{rol}">
                                <option th:each="rol : ${roles}"
                                        th:value="${rol.id}"
                                        th:text="${rol.rol}"
                                        th:if="${(session.usuario.rol.id == 1 and (rol.id == 1 or rol.id == 3 or rol.id == 4))
                                        or (session.usuario.rol.id == 4 and rol.id == 3)}">
                                </option>
                            </select>
                        </div>

                        <!-- Estado -->

                    </form>
                </div>

                <!-- Footer -->
                <div class="modal-footer bg-gray-50 shadow-inner rounded-bottom">
                    <button type="button"
                            class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 shadow-sm transition"
                            data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark me-1"></i> Cerrar
                    </button>
                    <button type="submit"
                            form="formAgregar"
                            class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 shadow-md transition">
                        <i class="fa-solid fa-floppy-disk me-1"></i> Guardar
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!--Modal para modificar usuario-->
    <div class="modal fade" id="editarModal" tabindex="-1" aria-labelledby="editarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content shadow-xl border-0 rounded-4 overflow-hidden">

                <!-- Header -->
                <div class="modal-header bg-green-700 text-white shadow-sm">
                    <h5 class="modal-title flex items-center gap-2" id="editarModalLabel">
                        <i class="fa-solid fa-user-pen"></i> Editar usuario
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <!-- Body -->
                <div class="modal-body bg-white">
                    <form id="formEditar" method="post" class="space-y-4">

                        <!-- ID oculto -->
                        <input type="hidden" id="editId">

                        <!-- Usuario -->
                        <div>
                            <label for="editUsuario" class="form-label fw-semibold">Usuario</label>
                            <input type="text"
                                   class="form-control rounded-3 border-2 border-gray-200 focus:border-green-600 focus:ring-0 shadow-sm"
                                   id="editUsuario"
                                   placeholder="Ingrese usuario" required>
                        </div>

                        <!-- Correo -->
                        <div>
                            <label for="editCorreo" class="form-label fw-semibold">Correo</label>
                            <input type="email"
                                   class="form-control rounded-3 border-2 border-gray-200 focus:border-green-600 focus:ring-0 shadow-sm"
                                   id="editCorreo"
                                   placeholder="ejemplo@correo.com" required>
                        </div>

                        <!-- Rol -->
                        <div>
                            <label for="editRol" class="form-label fw-semibold">Rol</label>
                            <select id="editRol"
                                    class="form-select rounded-3 border-2 border-gray-200 focus:border-green-600 focus:ring-0 shadow-sm">
                                <option th:each="rol : ${roles}"
                                        th:value="${rol.id}"
                                        th:text="${rol.rol}"
                                        th:if="${(session.usuario.rol.id == 1 and (rol.id == 1 or rol.id == 3 or rol.id == 4))
                                        or (session.usuario.rol.id == 4 and rol.id == 3)}">
                                </option>
                            </select>
                        </div>

                        <!-- Estado -->
                        <div>
                            <label for="editEstado" class="form-label fw-semibold">Estado</label>
                            <select id="editEstado"
                                    class="form-select rounded-3 border-2 border-gray-200 focus:border-green-600 focus:ring-0 shadow-sm">
                                <option th:each="estado : ${estados}" th:value="${estado.id}" th:text="${estado.estado}"></option>
                            </select>
                        </div>

                    </form>
                </div>

                <!-- Footer -->
                <div class="modal-footer bg-gray-50 shadow-inner rounded-bottom">
                    <button type="button"
                            class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 shadow-sm transition"
                            data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark me-1"></i> Cancelar
                    </button>
                    <button type="button" id="btnGuardarCambios"
                            class="px-4 py-2 rounded-lg bg-green-700 text-white hover:bg-green-800 shadow-md transition">
                        <i class="fa-solid fa-floppy-disk me-1"></i> Guardar cambios
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal de confirmación para eliminar/inactivar -->
    <div class="modal fade" id="eliminarModal" tabindex="-1" aria-labelledby="eliminarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="eliminarModalLabel">Confirmar Inactivación</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body text-center">
                    ¿Seguro que deseas inactivar este usuario?
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button id="btnConfirmarEliminar" type="button" class="btn btn-danger">Inactivar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="agregarClienteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content shadow-xl border-0 rounded-4 overflow-hidden">

                <div class="modal-header bg-blue-600 text-white shadow-sm">
                    <h5 class="modal-title flex items-center gap-2">
                        <i class="fa-solid fa-user-plus"></i> Nuevo Cliente
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body bg-white p-4">
                    <form id="formAgregarCliente" th:action="@{/usuarios/guardarCliente}" method="post" class="space-y-4">

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Usuario *</label>
                                <input type="text" name="nombreUsuario" class="form-control rounded-3" required placeholder="Ej: juanperez">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Correo *</label>
                                <input type="email" name="correo" class="form-control rounded-3" required placeholder="juan@email.com">
                            </div>

                            <div class="col-12">
                                <label class="form-label fw-semibold">Nombre Completo *</label>
                                <input type="text" name="nombreCompleto" class="form-control rounded-3" required placeholder="Ej: Juan Pérez">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Teléfono</label>
                                <input type="text" name="telefono" class="form-control rounded-3" placeholder="7777-8888">
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-semibold">Dirección</label>
                                <textarea name="direccion" class="form-control rounded-3" rows="2" placeholder="Dirección de entrega..."></textarea>
                            </div>
                        </div>

                    </form>
                </div>

                <div class="modal-footer bg-gray-50">
                    <button type="button" class="px-4 py-2 rounded-lg bg-gray-300 text-gray-800 hover:bg-gray-400 transition" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" form="formAgregarCliente" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-md transition">
                        <i class="fa-solid fa-save me-1"></i> Guardar Cliente
                    </button>
                </div>

            </div>
        </div>
    </div>



    <!-- Contenedor para los toasts -->
    <div id="toast-container" class="fixed top-4 right-4 space-y-3 z-50"></div>



</div>
<script th:src="@{js/usuarios.js}"></script>


